{% extends 'base.html' %}
{% block title %}Mealano - Dashboard{% endblock %}

{% block head %}
    <link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css') }}">
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Diet toggles
            const buttons = document.querySelectorAll(".diet");
            buttons.forEach(btn => {
                btn.addEventListener("click", () => {
                    buttons.forEach(b => b.classList.remove("selected"));
                    btn.classList.add("selected");
                });
            });

            // Success popup
            const popup = document.getElementById("successPopup");
            if (popup) {
                popup.style.display = "block";
                setTimeout(() => popup.style.display = "none", 3000);
            }

            // Generate click handler
            document.querySelector(".generate-btn").addEventListener("click", async () => {
                const selectedDiet = document.querySelector(".diet.selected").innerText;
                const calories     = document.querySelector("input[name='calories']").value;
                const meals        = document.querySelector("select[name='meals']").value;
                const minCarbs     = document.querySelector("input[name='minCarbs']").value;
                const minFat       = document.querySelector("input[name='minFat']").value;
                const minProtein   = document.querySelector("input[name='minProtein']").value;

                const res = await fetch("/generate", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        diet:        selectedDiet,
                        calories:    calories,
                        meals:       meals,
                        minCarbs:    minCarbs,
                        minFat:      minFat,
                        minProtein:  minProtein
                    })
                });

                const data = await res.json();
                console.log("Received recipes:", data);
                const resultsContainer = document.getElementById("recipe-results");
                resultsContainer.innerHTML = "";

                if (data.results && data.results.length) {
                    data.results.forEach(recipe => {
                        /* append recipe cards‚Ä¶ */
                    });
                } else {
                    resultsContainer.innerHTML = "<p>No recipes found. Try different values.</p>";
                }
            });
        });
    </script>
{% endblock %}

{% block content %}
  <header>
    <h1>Mealano ü•Ñ</h1>
  </header>

  <main>
    <div class="popup" id="successPopup">Logged in successfully!</div>

    <h2>Create your meal plan right here in seconds</h2>

    <div class="diet-box">
      <h3>Preferred Diet</h3>

      <div class="diet-options">
        <button class="diet selected">Anything</button>
        <button class="diet">Keto</button>
        <button class="diet">Mediterranean</button>
        <button class="diet">Paleo</button>
        <button class="diet">Vegan</button>
        <button class="diet">Vegetarian</button>
      </div>

      <div class="calorie-form">
        <label>I want to eat</label>
        <input type="number" name="calories" value="1800" min="0"> calories
        <br><br>
        in
        <select name="meals">
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5" selected>5</option>
          <option value="6">6</option>
        </select> meals
      </div>

      <div class="macro-notes">
        <ul>
          <li style="color: orange;">
            ‚óè Carbs (g): <input type="number" name="minCarbs" value="90" min="0">
          </li>
          <li style="color: teal;">
            ‚óè Fat (g): <input type="number" name="minFat" value="40" min="0">
          </li>
          <li style="color: purple;">
            ‚óè Protein (g): <input type="number" name="minProtein" value="90" min="0">
          </li>
        </ul>
      </div>

      <div>
        <button class="generate-btn">Generate</button>
      </div>
    </div>

    <!-- Container for results -->
    <div id="recipe-results" style="margin-top: 3em;"></div>
  </main>

  <nav class="bottom-nav">
    <a href="/browse">Browse Meals</a>
    <a href="/my-plan">My Meal Plan</a>
    <a href="/account">Account</a>
    <a href="{{ url_for('auth.logout') }}">Logout</a>
  </nav>
{% endblock %}
